{"version":3,"sources":["../../../src/actions/index.js"],"names":["loginUser","authError","logoutUser","fetchUsers","token","localStorage","getItem","interceptors","request","use","config","url","indexOf","headers","error","console","log","Promise","reject","response","data","message","push","setItem","status","email","password","dispatch","post","then","type","catch","payload","removeItem","get"],"mappings":"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","file":"index.js","sourcesContent":["import axios from 'axios';\nimport { browserHistory } from 'react-router';\nimport {\n    API_URL,\n    AUTH_USER,\n    UNAUTH_USER,\n    AUTH_ERROR,\n    FETCH_USERS\n} from './types';\n\nconst token = localStorage.getItem('token');\n\naxios.interceptors.request.use(function (config) {\n    // Do something before request is sent\n    if( (config.url.indexOf(API_URL) === 0 ) && token) {\n        config.headers['x-access-token'] = token;\n    }\n    //console.log(config);\n    return config;\n}, function (error) {\n    // Do something with request error\n    console.log(error);\n    return Promise.reject(error);\n});\n\n\naxios.interceptors.response.use(function (response) {\n    // Do something with response data\n    if(response.data.message == 'Failed to authenticate token'){\n        browserHistory.push('/login');\n    }\n    else if(response.config.url.indexOf(API_URL) === 0 && response.data.token) {\n        localStorage.setItem('token',response.data.token);\n    }\n\n    //console.log(response);\n    return response;\n}, function (error) {\n    // Do something with response error\n    if(error.status === 401){\n        browserHistory.push('/login');\n    }\n    /**\n     * Account Disabled\n     */\n    if(response.status === 401 && error.data.message == 'Team account disabled'  ){\n        logoutUser();\n        browserHistory.push('/login');\n    }\n\n    /**\n     * Forbiddend Unauthorized\n     */\n    if(error.status === 403 ){\n        //$state.go('home.error',{errorCode: 403});\n    }\n\n    /**\n     * Not Found\n     */\n    if(error.status === 404 ){\n        //$state.go('home.error',{errorCode: 404});\n    }\n\n    /**\n     * Invalid Token\n     */\n    if(error.status === 401 && error.data.message == 'Failed to authenticate token'){\n        logoutUser();\n        browserHistory.push('/login');\n    }\n    console.log(error);\n    return Promise.reject(response);\n});\n\nexport function loginUser({email, password}){\n    return function(dispatch){\n        axios.post(`${API_URL}/authenticate`, {email, password})\n            .then(response =>{\n                dispatch({type: AUTH_USER});\n                localStorage.setItem('token', response.data.token);\n                browserHistory.push('/admin/user_accounts');\n            })\n            .catch(() =>{\n                dispatch(authError('Bad Login Info'));\n            })\n    }\n}\n\nexport function authError(error){\n    return {\n        type: AUTH_ERROR,\n        payload: error\n    }\n}\n\nexport function logoutUser() {\n    localStorage.removeItem('token');\n\n    return {type: UNAUTH_USER};\n}\n\n\nexport function fetchUsers(){\n    return function (dispatch){\n        axios.get(`${API_URL}/api/admin/accounts`,{\n            headers:{'x-access-token':token}\n        })\n            .then(response => {\n                dispatch({\n                    type: FETCH_USERS,\n                    payload: response\n                })\n            })\n            .catch(() =>{\n                dispatch(authError('Error'));\n            })\n    }\n}\n"]}